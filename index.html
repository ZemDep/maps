<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление участками</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }
        .map-container {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow: hidden;
            position: relative;
        }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        .sidebar {
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .panel {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .panel-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .stat-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .stat-item {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        .stat-item.available {
            background-color: rgba(46, 125, 50, 0.1);
        }
        .stat-item.reserved {
            background-color: rgba(245, 124, 0, 0.1);
        }
        .stat-item.sold {
            background-color: rgba(198, 40, 40, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #1976d2;
            color: white;
        }
        .btn-success {
            background-color: #2e7d32;
            color: white;
        }
        .btn-warning {
            background-color: #f57c00;
            color: white;
        }
        .btn-danger {
            background-color: #c62828;
            color: white;
        }
        .btn-secondary {
            background-color: #757575;
            color: white;
        }
        .plot-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .plot-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .plot-item:hover {
            background-color: #f5f5f5;
        }
        .plot-item.selected {
            background-color: #e3f2fd;
        }
        .plot-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .plot-item-details {
            font-size: 12px;
            color: #666;
        }
        .plot-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }
        .plot-status.available {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        .plot-status.reserved {
            background-color: #ffe0b2;
            color: #f57c00;
        }
        .plot-status.sold {
            background-color: #ffcdd2;
            color: #c62828;
        }
        /* Улучшение выбора участков на SVG */
        path, polygon, rect {
            stroke: #000;
            stroke-width: 1;
            fill: transparent;
            fill-opacity: 0.7; /* Делаем заливку полупрозрачной */
            cursor: pointer;
            transition: fill 0.2s;
            pointer-events: all; /* Обеспечивает реакцию на события по всей площади */
        }
        /* Стили для первичной продажи */
        path[data-status="available"][data-substatus="primary"],
        polygon[data-status="available"][data-substatus="primary"],
        rect[data-status="available"][data-substatus="primary"] {
            fill: #c8e6c9; /* Стандартный зеленый для свободных участков */
        }
        path[data-status="reserved"],
        polygon[data-status="reserved"],
        rect[data-status="reserved"] {
            fill: #ffe0b2;
        }
        path[data-status="sold"],
        polygon[data-status="sold"],
        rect[data-status="sold"] {
            fill: #ffcdd2;
        }
        /* Стили для подстатуса инвестора */
        path[data-substatus="investor"],
        polygon[data-substatus="investor"],
        rect[data-substatus="investor"] {
            fill: #e57373; /* Более темный оттенок красного для инвесторов */
        }
        /* Стили для подстатуса "продажа от инвестора" */
        path[data-status="available"][data-substatus="from_investor"],
        polygon[data-status="available"][data-substatus="from_investor"],
        rect[data-status="available"][data-substatus="from_investor"] {
            fill: #81c784; /* Более темный оттенок зеленого для продаж от инвестора */
        }
        /* Стили для информационных объектов (группа OTHER) */
        path[data-object-type="info"],
        polygon[data-object-type="info"],
        rect[data-object-type="info"] {
            fill: #e3f2fd; /* Светло-голубой фон */
            fill-opacity: 0.5; /* Полупрозрачный */
            stroke: #1976d2; /* Синяя обводка */
            stroke-width: 1;
        }
        path[data-object-type="info"]:hover,
        polygon[data-object-type="info"]:hover,
        rect[data-object-type="info"]:hover {
            fill-opacity: 0.7;
            stroke-width: 2;
        }
        path:hover, polygon:hover, rect:hover {
            stroke-width: 2;
            stroke: #1976d2;
        }
        .search-bar {
            margin-bottom: 10px;
        }
        .search-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .filter-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
        }
        .filter-btn.active {
            background-color: #e3f2fd;
            border-color: #1976d2;
            color: #1976d2;
        }
        .export-import-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .export-import-group button {
            flex: 1;
        }
        .group-stats {
            margin-top: 15px;
        }
        .group-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .group-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .group-section h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        .subgroups {
            margin-top: 15px;
        }
        .subgroup {
            margin-bottom: 10px;
            padding-left: 15px;
            border-left: 2px solid #e0e0e0;
        }
        .subgroup h4 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #555;
        }
        .stat-group.small {
            display: flex;
            gap: 10px;
        }
        .stat-item-small {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        .stat-item-small.available {
            background-color: rgba(46, 125, 50, 0.1);
        }
        .stat-item-small.reserved {
            background-color: rgba(245, 124, 0, 0.1);
        }
        .stat-item-small.sold {
            background-color: rgba(198, 40, 40, 0.1);
        }
        .no-svg-message {
            text-align: center;
            padding: 50px 0;
            color: #757575;
        }
        .svg-upload-container {
            text-align: center;
            padding: 20px;
        }
        /* Стили для блока подстатуса */
        .substatus-group {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            display: none; /* Скрыт по умолчанию */
        }
        /* Стили для фильтра "От инвестора" */
        .filter-btn[data-filter="from_investor"] {
            background-color: #e8f5e9;
        }
        .filter-btn[data-filter="from_investor"].active {
            background-color: #81c784;
            border-color: #2e7d32;
            color: white;
        }
        /* Стили для блока инвесторов */
        .group-section.investors {
            background-color: #f9f9f9;
            border-left: 3px solid #9c27b0;
            padding-left: 15px;
            margin-top: 20px;
        }
        .group-section.investors h3 {
            color: #9c27b0;
        }
        /* Стили для счетчиков инвесторов */
        .stat-item.investor-sold {
            background-color: rgba(156, 39, 176, 0.1);
        }
        .stat-item.investor-available {
            background-color: rgba(76, 175, 80, 0.1);
        }
        .stat-item-small.investor-sold {
            background-color: rgba(156, 39, 176, 0.1);
        }
        .stat-item-small.investor-available {
            background-color: rgba(76, 175, 80, 0.1);
        }
        /* Новые стили для вкладок */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f5f5f5;
        }
        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: #1976d2;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Стили для GitHub авторизации */
        .github-auth {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .github-auth-status {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .github-auth-status.logged-in {
            color: #2e7d32;
        }
        .github-auth-status.logged-out {
            color: #c62828;
        }
        .github-auth-status.loading {
            color: #ff8f00;
        }
        .github-auth-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        .github-actions {
            margin-top: 15px;
        }
        .save-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        .save-status.saving {
            display: block;
            background-color: #fff9c4;
            color: #ff8f00;
        }
        .save-status.success {
            display: block;
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .save-status.error {
            display: block;
            background-color: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="map-container">
            <div id="svg-container">
                <!-- SVG будет загружен сюда -->
                <div class="no-svg-message" id="noSvgMessage">
                    <h3>Загрузка SVG карты...</h3>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <!-- GitHub авторизация -->
            <div class="panel github-auth" id="githubAuthPanel">
                <div class="panel-header">GitHub интеграция</div>
                <div class="github-auth-status logged-out" id="githubAuthStatus">
                    <span class="github-auth-icon">🔒</span>
                    <span id="authStatusText">Вход не выполнен</span>
                </div>
                <div id="githubLoginForm">
                    <div class="form-group">
                        <label for="githubUsername">Имя пользователя:</label>
                        <input type="text" id="githubUsername" placeholder="Введите имя пользователя GitHub">
                    </div>
                    <div class="form-group">
                        <label for="githubToken">Персональный токен доступа:</label>
                        <input type="password" id="githubToken" placeholder="Введите персональный токен GitHub">
                    </div>
                    <div class="form-group">
                        <label for="githubRepo">Репозиторий:</label>
                        <input type="text" id="githubRepo" placeholder="username/repository" value="zemdep/maps">
                    </div>
                    <button type="button" id="githubLoginBtn" class="btn-primary">Войти</button>
                </div>
                <div id="githubLoggedInActions" style="display: none;" class="github-actions">
                    <div class="btn-group">
                        <button type="button" id="saveToGithubBtn" class="btn-success">Сохранить изменения в GitHub</button>
                        <button type="button" id="logoutGithubBtn" class="btn-secondary">Выйти</button>
                    </div>
                    <div id="saveStatus" class="save-status"></div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">Список участков</div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="plotSearch" placeholder="Поиск по номеру или названию...">
                </div>
                <div class="filter-group">
                    <div class="filter-btn active" data-filter="all">Все</div>
                    <div class="filter-btn" data-filter="available">Свободные</div>
                    <div class="filter-btn" data-filter="reserved">Бронь</div>
                    <div class="filter-btn" data-filter="sold">Проданные</div>
                    <div class="filter-btn" data-filter="investor">Продано инвесторам</div>
                </div>
                <div class="filter-group">
                    <div class="filter-btn" data-filter="from_investor">Продажа от инвестора</div>
                    <div class="filter-btn" data-filter="primary">Первичная продажа</div>
                </div>
                <div class="plot-list" id="plotList">
                    <!-- Список участков будет добавлен здесь -->
                </div>
            </div>
            
            <div class="panel">
                <!-- Вкладки -->
                <div class="tabs">
                    <div class="tab active" data-tab="edit">Редактирование</div>
                    <div class="tab" data-tab="stats">Статистика</div>
                </div>
                
                <!-- Содержимое вкладки "Редактирование" -->
                <div class="tab-content active" id="edit-tab">
                    <div class="panel-header">Информация об участке</div>
                    <form id="plotForm">
                        <div class="form-group">
                            <label for="plotId">ID участка:</label>
                            <input type="text" id="plotId" readonly>
                        </div>
                        <div class="form-group">
                            <label for="plotTitle">Название:</label>
                            <input type="text" id="plotTitle">
                        </div>
                        <div class="form-group plot-field">
                            <label for="plotCadastralNumber">Кадастровый номер:</label>
                            <input type="text" id="plotCadastralNumber">
                        </div>
                        <div class="form-group plot-field">
                            <label for="plotArea">Площадь (сот.):</label>
                            <input type="text" id="plotArea" oninput="calculateTotalPrice()">
                        </div>
                        <div class="form-group plot-field">
                            <label for="plotPricePerSotka">Цена за сотку:</label>
                            <input type="text" id="plotPricePerSotka" oninput="calculateTotalPrice()">
                        </div>
                        <div class="form-group plot-field">
                            <label for="plotPrice">Итоговая цена:</label>
                            <input type="text" id="plotPrice">
                        </div>
                        <div class="form-group plot-field">
                            <label for="plotStatus">Статус:</label>
                            <select id="plotStatus" onchange="toggleSubstatusVisibility()">
                                <option value="available">Свободен</option>
                                <option value="reserved">Забронирован</option>
                                <option value="sold">Продан</option>
                            </select>
                        </div>
                        <!-- Блок для подстатуса "Свободен" -->
                        <div class="form-group substatus-group plot-field" id="availableSubstatusGroup">
                            <label for="plotAvailableSubstatus">Подстатус:</label>
                            <select id="plotAvailableSubstatus">
                                <option value="primary">Первичная продажа</option>
                                <option value="from_investor">Продажа от инвестора</option>
                            </select>
                        </div>
                        <!-- Блок для подстатуса "Продан" -->
                        <div class="form-group substatus-group plot-field" id="soldSubstatusGroup">
                            <label for="plotSoldSubstatus">Подстатус:</label>
                            <select id="plotSoldSubstatus">
                                <option value="">Обычный клиент</option>
                                <option value="investor">Инвестор</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="plotDescription">Описание:</label>
                            <textarea id="plotDescription"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="plotPrivateComment">Внутренний комментарий:</label>
                            <textarea id="plotPrivateComment"></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="button" id="savePlotBtn" class="btn-primary">Сохранить</button>
                            <button type="button" id="resetPlotBtn" class="btn-secondary">Отмена</button>
                        </div>
                    </form>
                </div>
                
                <!-- Содержимое вкладки "Статистика" -->
                <div class="tab-content" id="stats-tab">
                    <div class="panel-header">Статистика участков</div>
                    <div class="stat-group">
                        <div class="stat-item available">
                            <div class="stat-value" id="availableCount">0</div>
                            <div class="stat-label">Свободно</div>
                        </div>
                        <div class="stat-item reserved">
                            <div class="stat-value" id="reservedCount">0</div>
                            <div class="stat-label">Забронировано</div>
                        </div>
                        <div class="stat-item sold">
                            <div class="stat-value" id="soldCount">0</div>
                            <div class="stat-label">Продано</div>
                        </div>
                    </div>
                    
                    <!-- Статистика по группам -->
                    <div class="group-stats">
                        <div class="group-section">
                            <h3>ERLAN</h3>
                            <div class="stat-group">
                                <div class="stat-item available">
                                    <div class="stat-value" id="erlanAvailableCount">0</div>
                                    <div class="stat-label">Свободно</div>
                                </div>
                                <div class="stat-item reserved">
                                    <div class="stat-value" id="erlanReservedCount">0</div>
                                    <div class="stat-label">Забронировано</div>
                                </div>
                                <div class="stat-item sold">
                                    <div class="stat-value" id="erlanSoldCount">0</div>
                                    <div class="stat-label">Продано</div>
                                </div>
                            </div>
                            
                            <div class="subgroups">
                                <div class="subgroup">
                                    <h4>Res1</h4>
                                    <div class="stat-group small">
                                        <div class="stat-item-small available">
                                            <span id="erlanRes1AvailableCount">0</span> свободно
                                        </div>
                                        <div class="stat-item-small reserved">
                                            <span id="erlanRes1ReservedCount">0</span> бронь
                                        </div>
                                        <div class="stat-item-small sold">
                                            <span id="erlanRes1SoldCount">0</span> продано
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="subgroup">
                                    <h4>Res2</h4>
                                    <div class="stat-group small">
                                        <div class="stat-item-small available">
                                            <span id="erlanRes2AvailableCount">0</span> свободно
                                        </div>
                                        <div class="stat-item-small reserved">
                                            <span id="erlanRes2ReservedCount">0</span> бронь
                                        </div>
                                        <div class="stat-item-small sold">
                                            <span id="erlanRes2SoldCount">0</span> продано
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="subgroup">
                                    <h4>ZD</h4>
                                    <div class="stat-group small">
                                        <div class="stat-item-small available">
                                            <span id="erlanZDAvailableCount">0</span> свободно
                                        </div>
                                        <div class="stat-item-small reserved">
                                            <span id="erlanZDReservedCount">0</span> бронь
                                        </div>
                                        <div class="stat-item-small sold">
                                            <span id="erlanZDSoldCount">0</span> продано
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="group-section">
                            <h3>IGOR</h3>
                            <div class="stat-group">
                                <div class="stat-item available">
                                    <div class="stat-value" id="igorAvailableCount">0</div>
                                    <div class="stat-label">Свободно</div>
                                </div>
                                <div class="stat-item reserved">
                                    <div class="stat-value" id="igorReservedCount">0</div>
                                    <div class="stat-label">Забронировано</div>
                                </div>
                                <div class="stat-item sold">
                                    <div class="stat-value" id="igorSoldCount">0</div>
                                    <div class="stat-label">Продано</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="group-section">
                            <h3>OTHER</h3>
                            <div class="stat-group">
                                <div class="stat-item available">
                                    <div class="stat-value" id="otherAvailableCount">0</div>
                                    <div class="stat-label">Всего объектов</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Статистика инвесторов -->
                        <div class="group-section investors">
                            <h3>ИНВЕСТОРЫ</h3>
                            <div class="stat-group">
                                <div class="stat-item sold">
                                    <div class="stat-value" id="investorSoldCount">0</div>
                                    <div class="stat-label">У инвесторов</div>
                                </div>
                                <div class="stat-item available">
                                    <div class="stat-value" id="fromInvestorAvailableCount">0</div>
                                    <div class="stat-label">В продаже от инвесторов</div>
                                </div>
                            </div>
                            
                                                        <!-- Детальная статистика по группам инвесторов -->
                            <div class="subgroups">
                                <div class="subgroup">
                                    <h4>ERLAN</h4>
                                    <div class="stat-group small">
                                        <div class="stat-item-small sold">
                                            <span id="erlanInvestorSoldCount">0</span> у инвесторов
                                        </div>
                                        <div class="stat-item-small available">
                                            <span id="erlanFromInvestorAvailableCount">0</span> в продаже
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="subgroup">
                                    <h4>IGOR</h4>
                                    <div class="stat-group small">
                                        <div class="stat-item-small sold">
                                            <span id="igorInvestorSoldCount">0</span> у инвесторов
                                        </div>
                                        <div class="stat-item-small available">
                                            <span id="igorFromInvestorAvailableCount">0</span> в продаже
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let plotsData = {};
        let elementsInfo = [];
        let selectedPlotId = null;
        let svgElement = null;
        let svgLoaded = false;
        
        // GitHub API переменные
        let githubUsername = '';
        let githubToken = '';
        let githubRepo = '';
        let isGithubLoggedIn = false;
        
        // Константы для URL
        const SVG_URL = 'https://zemdep.github.io/maps/Uvildy_residens.svg';
        const JSON_URL = 'https://zemdep.github.io/maps/uvildy-plots-data.json';
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Загрузка данных об участках
            fetchPlotsData();
            
            // Загрузка SVG карты
            loadSvgMap();
            
            // Инициализация обработчиков событий
            initEventHandlers();
            
            // Проверка сохраненных GitHub учетных данных
            checkGithubAuth();
        });
        
        // Функция для загрузки данных об участках
        function fetchPlotsData() {
            fetch(JSON_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Ошибка загрузки данных об участках');
                    }
                    return response.json();
                })
                .then(data => {
                    plotsData = data;
                    renderPlotsList();
                    updateStatistics();
                    
                    // Если SVG уже загружена, обновляем её цвета
                    if (svgLoaded) {
                        updateSvgColors();
                    }
                })
                .catch(error => {
                    console.error('Ошибка:', error);
                    alert('Не удалось загрузить данные об участках. Пожалуйста, проверьте соединение и попробуйте снова.');
                });
        }
        
        // Функция для загрузки SVG карты
        function loadSvgMap() {
            fetch(SVG_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Ошибка загрузки SVG карты');
                    }
                    return response.text();
                })
                .then(svgContent => {
                    const svgContainer = document.getElementById('svg-container');
                    svgContainer.innerHTML = svgContent;
                    
                    // Получаем ссылку на SVG элемент
                    svgElement = svgContainer.querySelector('svg');
                    
                    // Добавляем возможность масштабирования и перемещения
                    initSvgPanZoom();
                    
                    // Получаем все элементы на карте и добавляем обработчики событий
                    const elements = svgElement.querySelectorAll('path, polygon, rect');
                    elements.forEach(element => {
                        const id = element.id;
                        if (id && id.startsWith('plot')) {
                            // Добавляем обработчик клика
                            element.addEventListener('click', function() {
                                selectPlot(id);
                            });
                            
                            // Сохраняем информацию об элементе
                            elementsInfo.push({
                                id: id,
                                element: element
                            });
                        }
                    });
                    
                    // Обновляем цвета участков на SVG
                    updateSvgColors();
                    
                    // Скрываем сообщение о загрузке
                    document.getElementById('noSvgMessage').style.display = 'none';
                    
                    svgLoaded = true;
                })
                .catch(error => {
                    console.error('Ошибка:', error);
                    document.getElementById('noSvgMessage').innerHTML = '<h3>Ошибка загрузки карты</h3><p>Пожалуйста, проверьте соединение и обновите страницу.</p>';
                });
        }
        
        // Инициализация библиотеки для масштабирования и перемещения SVG
        function initSvgPanZoom() {
            // Здесь можно добавить инициализацию библиотеки для масштабирования и перемещения SVG
            // Например, с использованием svg-pan-zoom.js
            // Для простоты пример не включает эту функциональность
        }
        
        // Функция для обновления цветов участков на SVG в соответствии с их статусами
        function updateSvgColors() {
            if (!svgElement || !plotsData) return;
            
            elementsInfo.forEach(info => {
                const plotId = info.id;
                const element = info.element;
                const plotData = plotsData[plotId];
                
                if (plotData) {
                    // Устанавливаем атрибуты данных для стилизации через CSS
                    element.setAttribute('data-status', plotData.status || 'available');
                    element.setAttribute('data-substatus', plotData.substatus || '');
                    
                    // Добавляем всплывающую подсказку
                    let tooltipText = `${plotData.title || 'Участок'}\n`;
                    tooltipText += `Площадь: ${plotData.area || '?'} сот.\n`;
                    tooltipText += `Цена: ${formatPrice(plotData.price) || '?'} руб.`;
                    
                    element.setAttribute('title', tooltipText);
                }
            });
        }
        
        // Функция для выбора участка
        function selectPlot(plotId) {
            selectedPlotId = plotId;
            
            // Обновляем выбранный элемент в списке
            const listItems = document.querySelectorAll('.plot-item');
            listItems.forEach(item => {
                item.classList.remove('selected');
                if (item.getAttribute('data-id') === plotId) {
                    item.classList.add('selected');
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            });
            
            // Заполняем форму данными выбранного участка
            fillPlotForm(plotId);
            
            // Подсвечиваем выбранный участок на карте
            highlightSelectedPlot(plotId);
        }
        
        // Функция для подсветки выбранного участка на карте
        function highlightSelectedPlot(plotId) {
            // Сбрасываем стили всех элементов
            elementsInfo.forEach(info => {
                info.element.style.strokeWidth = '';
                info.element.style.stroke = '';
            });
            
            // Находим выбранный элемент и применяем стиль
            const selectedElement = elementsInfo.find(info => info.id === plotId);
            if (selectedElement) {
                selectedElement.element.style.strokeWidth = '3px';
                selectedElement.element.style.stroke = '#ff9800';
            }
        }
        
        // Функция для заполнения формы данными выбранного участка
        function fillPlotForm(plotId) {
            const plotData = plotsData[plotId] || {};
            
            document.getElementById('plotId').value = plotId || '';
            document.getElementById('plotTitle').value = plotData.title || '';
            document.getElementById('plotCadastralNumber').value = plotData.cadastralNumber || '';
            document.getElementById('plotArea').value = plotData.area || '';
            document.getElementById('plotPricePerSotka').value = plotData.pricePerSotka || '';
            document.getElementById('plotPrice').value = plotData.price || '';
            document.getElementById('plotDescription').value = plotData.description || '';
            document.getElementById('plotPrivateComment').value = plotData.privateComment || '';
            
            // Устанавливаем статус
            const statusSelect = document.getElementById('plotStatus');
            statusSelect.value = plotData.status || 'available';
            
            // Обновляем видимость и значения блоков подстатусов
            toggleSubstatusVisibility();
            
            // Устанавливаем подстатус для свободных участков
            if (plotData.status === 'available') {
                document.getElementById('plotAvailableSubstatus').value = plotData.substatus || 'primary';
            }
            
            // Устанавливаем подстатус для проданных участков
            if (plotData.status === 'sold') {
                document.getElementById('plotSoldSubstatus').value = plotData.substatus || '';
            }
        }
        
        // Функция для отображения/скрытия блоков подстатусов в зависимости от выбранного статуса
        function toggleSubstatusVisibility() {
            const status = document.getElementById('plotStatus').value;
            const availableSubstatusGroup = document.getElementById('availableSubstatusGroup');
            const soldSubstatusGroup = document.getElementById('soldSubstatusGroup');
            
            // Скрываем оба блока подстатусов
            availableSubstatusGroup.style.display = 'none';
            soldSubstatusGroup.style.display = 'none';
            
            // Отображаем соответствующий блок подстатуса
            if (status === 'available') {
                availableSubstatusGroup.style.display = 'block';
            } else if (status === 'sold') {
                soldSubstatusGroup.style.display = 'block';
            }
        }
        
        // Функция для расчета итоговой цены
        function calculateTotalPrice() {
            const area = parseFloat(document.getElementById('plotArea').value.replace(',', '.')) || 0;
            const pricePerSotka = parseFloat(document.getElementById('plotPricePerSotka').value.replace(/\s/g, '')) || 0;
            const totalPrice = area * pricePerSotka;
            
            document.getElementById('plotPrice').value = Math.round(totalPrice);
        }
        
        // Функция для отображения списка участков
        function renderPlotsList(filter = 'all') {
            const plotList = document.getElementById('plotList');
            const searchQuery = document.getElementById('plotSearch').value.toLowerCase();
            
            // Очищаем список
            plotList.innerHTML = '';
            
            // Фильтруем и сортируем участки
            const filteredPlots = Object.entries(plotsData)
                .filter(([id, plot]) => {
                    // Применяем фильтр поиска
                    const matchesSearch = (plot.title && plot.title.toLowerCase().includes(searchQuery)) || 
                                        (plot.cadastralNumber && plot.cadastralNumber.toLowerCase().includes(searchQuery)) ||
                                        id.toLowerCase().includes(searchQuery);
                    
                    if (!matchesSearch) return false;
                    
                    // Применяем фильтр по статусу
                    if (filter === 'all') return true;
                    if (filter === 'available' && plot.status === 'available' && plot.substatus !== 'from_investor') return true;
                    if (filter === 'reserved' && plot.status === 'reserved') return true;
                    if (filter === 'sold' && plot.status === 'sold' && plot.substatus !== 'investor') return true;
                    if (filter === 'investor' && plot.status === 'sold' && plot.substatus === 'investor') return true;
                    if (filter === 'from_investor' && plot.status === 'available' && plot.substatus === 'from_investor') return true;
                    if (filter === 'primary' && plot.status === 'available' && plot.substatus === 'primary') return true;
                    
                    return false;
                })
                .sort(([idA, plotA], [idB, plotB]) => {
                    // Сортируем по названию или ID
                    const titleA = plotA.title || idA;
                    const titleB = plotB.title || idB;
                    return titleA.localeCompare(titleB);
                });
            
            // Добавляем элементы в список
            filteredPlots.forEach(([id, plot]) => {
                const plotItem = document.createElement('div');
                plotItem.className = 'plot-item';
                plotItem.setAttribute('data-id', id);
                
                if (id === selectedPlotId) {
                    plotItem.classList.add('selected');
                }
                
                // Определяем класс статуса для отображения
                let statusClass = '';
                let statusText = '';
                
                if (plot.status === 'available') {
                    statusClass = 'available';
                    statusText = 'Свободен';
                    if (plot.substatus === 'from_investor') {
                        statusText += ' (от инвестора)';
                    }
                } else if (plot.status === 'reserved') {
                    statusClass = 'reserved';
                    statusText = 'Бронь';
                } else if (plot.status === 'sold') {
                    statusClass = 'sold';
                    statusText = 'Продан';
                    if (plot.substatus === 'investor') {
                        statusText += ' (инвестору)';
                    }
                }
                
                // Формируем HTML содержимое элемента
                plotItem.innerHTML = `
                    <div class="plot-item-title">
                        ${plot.title || id}
                        <span class="plot-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="plot-item-details">
                        Площадь: ${plot.area || '?'} сот. | Цена: ${formatPrice(plot.price) || '?'} руб.
                    </div>
                `;
                
                // Добавляем обработчик клика
                plotItem.addEventListener('click', function() {
                    selectPlot(id);
                });
                
                plotList.appendChild(plotItem);
            });
            
            // Если список пуст, показываем сообщение
            if (filteredPlots.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'plot-item';
                emptyMessage.textContent = 'Участки не найдены';
                plotList.appendChild(emptyMessage);
            }
        }
        
        // Функция для обновления статистики
        function updateStatistics() {
            // Счетчики для общей статистики
            let availableCount = 0;
            let reservedCount = 0;
            let soldCount = 0;
            
            // Счетчики для групп
            let erlanAvailable = 0;
            let erlanReserved = 0;
            let erlanSold = 0;
            
            let igorAvailable = 0;
            let igorReserved = 0;
            let igorSold = 0;
            
            let otherCount = 0;
            
            // Счетчики для подгрупп ERLAN
            let erlanRes1Available = 0;
            let erlanRes1Reserved = 0;
            let erlanRes1Sold = 0;
            
            let erlanRes2Available = 0;
            let erlanRes2Reserved = 0;
            let erlanRes2Sold = 0;
            
            let erlanZDAvailable = 0;
            let erlanZDReserved = 0;
            let erlanZDSold = 0;
            
            // Счетчики для инвесторов
            let investorSoldCount = 0;
            let fromInvestorAvailableCount = 0;
            
            let erlanInvestorSoldCount = 0;
            let erlanFromInvestorAvailableCount = 0;
            
            let igorInvestorSoldCount = 0;
            let igorFromInvestorAvailableCount = 0;
            
            // Подсчитываем статистику
            Object.values(plotsData).forEach(plot => {
                // Определяем группу
                const group = plot.group || '';
                const subgroup = plot.subgroup || '';
                
                // Общая статистика
                if (plot.status === 'available') {
                    availableCount++;
                    
                    // Статистика "от инвестора"
                    if (plot.substatus === 'from_investor') {
                        fromInvestorAvailableCount++;
                        
                        if (group === 'ERLAN') {
                            erlanFromInvestorAvailableCount++;
                        } else if (group === 'IGOR') {
                            igorFromInvestorAvailableCount++;
                        }
                    }
                } else if (plot.status === 'reserved') {
                    reservedCount++;
                } else if (plot.status === 'sold') {
                    soldCount++;
                    
                    // Статистика инвесторов
                    if (plot.substatus === 'investor') {
                        investorSoldCount++;
                        
                        if (group === 'ERLAN') {
                            erlanInvestorSoldCount++;
                        } else if (group === 'IGOR') {
                            igorInvestorSoldCount++;
                        }
                    }
                }
                
                // Статистика по группам
                if (group === 'ERLAN') {
                    if (plot.status === 'available') erlanAvailable++;
                    else if (plot.status === 'reserved') erlanReserved++;
                    else if (plot.status === 'sold') erlanSold++;
                    
                    // Статистика по подгруппам ERLAN
                    if (subgroup === 'Res1') {
                        if (plot.status === 'available') erlanRes1Available++;
                        else if (plot.status === 'reserved') erlanRes1Reserved++;
                        else if (plot.status === 'sold') erlanRes1Sold++;
                    } else if (subgroup === 'Res2') {
                        if (plot.status === 'available') erlanRes2Available++;
                        else if (plot.status === 'reserved') erlanRes2Reserved++;
                        else if (plot.status === 'sold') erlanRes2Sold++;
                    } else if (subgroup === 'ZD') {
                        if (plot.status === 'available') erlanZDAvailable++;
                        else if (plot.status === 'reserved') erlanZDReserved++;
                        else if (plot.status === 'sold') erlanZDSold++;
                    }
                } else if (group === 'IGOR') {
                    if (plot.status === 'available') igorAvailable++;
                    else if (plot.status === 'reserved') igorReserved++;
                    else if (plot.status === 'sold') igorSold++;
                } else if (group === 'OTHER') {
                    otherCount++;
                }
            });
            
            // Обновляем общую статистику
            document.getElementById('availableCount').textContent = availableCount;
            document.getElementById('reservedCount').textContent = reservedCount;
            document.getElementById('soldCount').textContent = soldCount;
            
            // Обновляем статистику по группам
            document.getElementById('erlanAvailableCount').textContent = erlanAvailable;
            document.getElementById('erlanReservedCount').textContent = erlanReserved;
            document.getElementById('erlanSoldCount').textContent = erlanSold;
            
            document.getElementById('igorAvailableCount').textContent = igorAvailable;
            document.getElementById('igorReservedCount').textContent = igorReserved;
            document.getElementById('igorSoldCount').textContent = igorSold;
            
            document.getElementById('otherAvailableCount').textContent = otherCount;
            
            // Обновляем статистику по подгруппам ERLAN
            document.getElementById('erlanRes1AvailableCount').textContent = erlanRes1Available;
            document.getElementById('erlanRes1ReservedCount').textContent = erlanRes1Reserved;
            document.getElementById('erlanRes1SoldCount').textContent = erlanRes1Sold;
            
            document.getElementById('erlanRes2AvailableCount').textContent = erlanRes2Available;
            document.getElementById('erlanRes2ReservedCount').textContent = erlanRes2Reserved;
            document.getElementById('erlanRes2SoldCount').textContent = erlanRes2Sold;
            
            document.getElementById('erlanZDAvailableCount').textContent = erlanZDAvailable;
            document.getElementById('erlanZDReservedCount').textContent = erlanZDReserved;
            document.getElementById('erlanZDSoldCount').textContent = erlanZDSold;
            
            // Обновляем статистику инвесторов
            document.getElementById('investorSoldCount').textContent = investorSoldCount;
            document.getElementById('fromInvestorAvailableCount').textContent = fromInvestorAvailableCount;
            
            document.getElementById('erlanInvestorSoldCount').textContent = erlanInvestorSoldCount;
            document.getElementById('erlanFromInvestorAvailableCount').textContent = erlanFromInvestorAvailableCount;
            
            document.getElementById('igorInvestorSoldCount').textContent = igorInvestorSoldCount;
            document.getElementById('igorFromInvestorAvailableCount').textContent = igorFromInvestorAvailableCount;
        }
        
        // Функция для сохранения данных об участке
        function savePlotData() {
            if (!selectedPlotId) {
                alert('Выберите участок для редактирования');
                return;
            }
            
            // Получаем данные из формы
            const plotId = document.getElementById('plotId').value;
            const title = document.getElementById('plotTitle').value;
            const cadastralNumber = document.getElementById('plotCadastralNumber').value;
            const area = document.getElementById('plotArea').value;
            const pricePerSotka = document.getElementById('plotPricePerSotka').value;
            const price = document.getElementById('plotPrice').value;
            const description = document.getElementById('plotDescription').value;
            const privateComment = document.getElementById('plotPrivateComment').value;
            const status = document.getElementById('plotStatus').value;
            
            // Определяем подстатус в зависимости от статуса
            let substatus = '';
            if (status === 'available') {
                substatus = document.getElementById('plotAvailableSubstatus').value;
            } else if (status === 'sold') {
                substatus = document.getElementById('plotSoldSubstatus').value;
            }
            
            // Обновляем данные в объекте
            plotsData[plotId] = {
                ...plotsData[plotId],
                id: plotId,
                title,
                cadastralNumber,
                area,
                pricePerSotka,
                price,
                status,
                substatus,
                description,
                privateComment,
                group: plotsData[plotId]?.group || '',
                subgroup: plotsData[plotId]?.subgroup || ''
            };
            
            // Обновляем отображение
            renderPlotsList();
            updateStatistics();
            updateSvgColors();
            
            alert('Данные участка успешно обновлены');
        }
        
        // Функция для форматирования цены
        function formatPrice(price) {
            if (!price) return '';
            return parseInt(price).toLocaleString('ru-RU');
        }
        
        // Функция для инициализации обработчиков событий
        function initEventHandlers() {
            // Обработчик для кнопки сохранения участка
            document.getElementById('savePlotBtn').addEventListener('click', savePlotData);
            
            // Обработчик для кнопки отмены редактирования
            document.getElementById('resetPlotBtn').addEventListener('click', function() {
                if (selectedPlotId) {
                    fillPlotForm(selectedPlotId);
                }
            });
            
            // Обработчики для фильтров списка участков
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Убираем активный класс со всех кнопок в группе
                    const filterGroup = this.parentElement;
                    filterGroup.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Добавляем активный класс на нажатую кнопку
                    this.classList.add('active');
                    
                    // Применяем фильтр
                    const filter = this.getAttribute('data-filter');
                    renderPlotsList(filter);
                });
            });
            
            // Обработчик для поля поиска
            document.getElementById('plotSearch').addEventListener('input', function() {
                // Находим активный фильтр
                const activeFilter = document.querySelector('.filter-btn.active');
                const filter = activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
                
                // Обновляем список с учетом фильтра
                renderPlotsList(filter);
            });
            
            // Обработчики для вкладок
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Убираем активный класс со всех вкладок
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Добавляем активный класс на нажатую вкладку
                    this.classList.add('active');
                    
                    // Скрываем все содержимое вкладок
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Показываем содержимое выбранной вкладки
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Обработчики для GitHub авторизации
            document.getElementById('githubLoginBtn').addEventListener('click', loginToGithub);
            document.getElementById('logoutGithubBtn').addEventListener('click', logoutFromGithub);
            document.getElementById('saveToGithubBtn').addEventListener('click', saveDataToGithub);
        }
        
        // Функция для проверки сохраненных GitHub учетных данных
        function checkGithubAuth() {
            // Проверяем, есть ли сохраненные данные в localStorage
            githubUsername = localStorage.getItem('githubUsername');
            githubToken = localStorage.getItem('githubToken');
            githubRepo = localStorage.getItem('githubRepo');
            
            if (githubUsername && githubToken && githubRepo) {
                // Устанавливаем значения в форму
                document.getElementById('githubUsername').value = githubUsername;
                document.getElementById('githubToken').value = githubToken;
                document.getElementById('githubRepo').value = githubRepo;
                
                // Выполняем вход
                loginToGithub(true);
            }
        }
        
        // Функция для входа в GitHub
        function loginToGithub(skipValidation = false) {
            if (!skipValidation) {
                // Получаем значения из формы
                githubUsername = document.getElementById('githubUsername').value.trim();
                githubToken = document.getElementById('githubToken').value.trim();
                githubRepo = document.getElementById('githubRepo').value.trim();
                
                // Проверяем, что все поля заполнены
                if (!githubUsername || !githubToken || !githubRepo) {
                    alert('Пожалуйста, заполните все поля для входа в GitHub');
                    return;
                }
                
                // Сохраняем данные в localStorage
                localStorage.setItem('githubUsername', githubUsername);
                localStorage.setItem('githubToken', githubToken);
                localStorage.setItem('githubRepo', githubRepo);
            }
            
                        // Обновляем UI для отображения состояния загрузки
            const authStatus = document.getElementById('githubAuthStatus');
            authStatus.className = 'github-auth-status loading';
            authStatus.innerHTML = `
                <span class="github-auth-icon">⏳</span>
                <span id="authStatusText">Проверка авторизации...</span>
            `;
            
            // Создаем заголовки для запроса
            const headers = new Headers();
            headers.append('Authorization', `token ${githubToken}`);
            headers.append('Accept', 'application/vnd.github.v3+json');
            
            // Проверяем доступ к репозиторию
            fetch(`https://api.github.com/repos/${githubRepo}`, {
                method: 'GET',
                headers: headers,
                cache: 'no-store'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Ошибка доступа к репозиторию');
                }
                return response.json();
            })
            .then(data => {
                // Успешная авторизация
                isGithubLoggedIn = true;
                
                // Обновляем UI
                document.getElementById('githubLoginForm').style.display = 'none';
                document.getElementById('githubLoggedInActions').style.display = 'block';
                
                authStatus.className = 'github-auth-status logged-in';
                authStatus.innerHTML = `
                    <span class="github-auth-icon">✅</span>
                    <span id="authStatusText">Вход выполнен как ${githubUsername} в репозитории ${githubRepo}</span>
                `;
                
                console.log('Успешный вход в GitHub');
            })
            .catch(error => {
                console.error('Ошибка входа в GitHub:', error);
                
                // Обновляем UI для отображения ошибки
                authStatus.className = 'github-auth-status logged-out';
                authStatus.innerHTML = `
                    <span class="github-auth-icon">❌</span>
                    <span id="authStatusText">Ошибка авторизации. Проверьте имя пользователя, токен и репозиторий.</span>
                `;
                
                // Сбрасываем авторизацию
                isGithubLoggedIn = false;
                document.getElementById('githubLoggedInActions').style.display = 'none';
                document.getElementById('githubLoginForm').style.display = 'block';
            });
        }
        
        // Функция для выхода из GitHub
        function logoutFromGithub() {
            // Сбрасываем переменные
            isGithubLoggedIn = false;
            githubUsername = '';
            githubToken = '';
            githubRepo = '';
            
            // Очищаем localStorage
            localStorage.removeItem('githubUsername');
            localStorage.removeItem('githubToken');
            localStorage.removeItem('githubRepo');
            
            // Очищаем поля формы
            document.getElementById('githubUsername').value = '';
            document.getElementById('githubToken').value = '';
            document.getElementById('githubRepo').value = 'zemdep/maps';
            
            // Обновляем UI
            document.getElementById('githubLoginForm').style.display = 'block';
            document.getElementById('githubLoggedInActions').style.display = 'none';
            
            const authStatus = document.getElementById('githubAuthStatus');
            authStatus.className = 'github-auth-status logged-out';
            authStatus.innerHTML = `
                <span class="github-auth-icon">🔒</span>
                <span id="authStatusText">Вход не выполнен</span>
            `;
            
            console.log('Выход из GitHub выполнен');
        }
        
        // Функция для сохранения данных в GitHub
        function saveDataToGithub() {
            if (!isGithubLoggedIn) {
                alert('Пожалуйста, войдите в GitHub перед сохранением данных');
                return;
            }
            
            // Показываем статус сохранения
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.textContent = 'Сохранение...';
            saveStatus.className = 'save-status saving';
            
            // Преобразуем данные в JSON строку с отступами для читаемости
            const jsonData = JSON.stringify(plotsData, null, 2);
            const encodedContent = btoa(unescape(encodeURIComponent(jsonData))); // Кодируем в base64
            
            // Создаем заголовки для запроса
            const headers = new Headers();
            headers.append('Authorization', `token ${githubToken}`);
            headers.append('Accept', 'application/vnd.github.v3+json');
            
            // Сначала проверяем, существует ли файл
            fetch(`https://api.github.com/repos/${githubRepo}/contents/uvildy-plots-data.json`, {
                method: 'GET',
                headers: headers
            })
            .then(response => {
                if (response.status === 404) {
                    // Файл не существует, создаем новый
                    return { exists: false };
                } else if (!response.ok) {
                    throw new Error('Ошибка получения информации о файле');
                }
                return response.json().then(data => {
                    return { exists: true, sha: data.sha };
                });
            })
            .then(fileInfo => {
                // Создаем данные для запроса
                const requestData = {
                    message: 'Обновление данных об участках',
                    content: encodedContent
                };
                
                // Если файл существует, добавляем SHA для обновления
                if (fileInfo.exists) {
                    requestData.sha = fileInfo.sha;
                }
                
                // Создаем или обновляем файл
                return fetch(`https://api.github.com/repos/${githubRepo}/contents/uvildy-plots-data.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ошибка сохранения файла: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Данные успешно сохранены в GitHub:', data);
                
                // Обновляем статус
                saveStatus.textContent = 'Данные успешно сохранены!';
                saveStatus.className = 'save-status success';
                
                // Скрываем статус через 3 секунды
                setTimeout(() => {
                    saveStatus.textContent = '';
                    saveStatus.className = 'save-status';
                }, 3000);
            })
            .catch(error => {
                console.error('Ошибка сохранения в GitHub:', error);
                
                // Обновляем статус
                saveStatus.textContent = 'Ошибка сохранения данных';
                saveStatus.className = 'save-status error';
                
                // Скрываем статус через 3 секунды
                setTimeout(() => {
                    saveStatus.textContent = '';
                    saveStatus.className = 'save-status';
                }, 3000);
            });
        }
        
        // Функция для загрузки данных из GitHub
        function loadDataFromGithub() {
            if (!isGithubLoggedIn) {
                alert('Пожалуйста, войдите в GitHub перед загрузкой данных');
                return;
            }
            
            // Показываем статус загрузки
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.textContent = 'Загрузка данных...';
            saveStatus.className = 'save-status saving';
            
            // Создаем заголовки для запроса
            const headers = new Headers();
            headers.append('Authorization', `token ${githubToken}`);
            headers.append('Accept', 'application/vnd.github.v3+json');
            
            // Получаем файл из репозитория
            fetch(`https://api.github.com/repos/${githubRepo}/contents/uvildy-plots-data.json`, {
                method: 'GET',
                headers: headers
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ошибка загрузки файла: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Декодируем содержимое из base64
                const content = decodeURIComponent(escape(atob(data.content)));
                plotsData = JSON.parse(content);
                
                // Обновляем отображение
                renderPlotsList();
                updateStatistics();
                updateSvgColors();
                
                // Обновляем статус
                saveStatus.textContent = 'Данные успешно загружены!';
                saveStatus.className = 'save-status success';
                
                // Скрываем статус через 3 секунды
                setTimeout(() => {
                    saveStatus.textContent = '';
                    saveStatus.className = 'save-status';
                }, 3000);
            })
            .catch(error => {
                console.error('Ошибка загрузки из GitHub:', error);
                
                // Обновляем статус
                saveStatus.textContent = 'Ошибка загрузки данных';
                saveStatus.className = 'save-status error';
                
                // Скрываем статус через 3 секунды
                setTimeout(() => {
                    saveStatus.textContent = '';
                    saveStatus.className = 'save-status';
                }, 3000);
            });
        }
    </script>
</body>
</html>
